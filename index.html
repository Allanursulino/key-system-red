<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>24H KEY ‚Ä¢ RED EDITION</title>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    body {margin:0;background:#000;color:#ff0048;font-family:'Courier New',monospace;overflow:hidden;}
    #particles-js {position:absolute;width:100%;height:100%;background:#000;}
    .container {position:relative;z-index:2;text-align:center;padding-top:15vh;}
    h1 {font-size:50px;text-shadow:0 0 20px #ff0048;margin-bottom:20px;}
    .instructions {margin:30px auto;max-width:600px;text-align:left;background:rgba(255,0,72,0.1);padding:25px;border-radius:15px;border:2px solid #ff0048;}
    button {padding:18px 50px;font-size:24px;background:#ff0048;color:#000;border:none;border-radius:12px;cursor:pointer;transition:0.4s;box-shadow:0 0 25px #ff0048;font-family:'Courier New',monospace;font-weight:bold;margin:10px;}
    button:hover {background:#ff3366;box-shadow:0 0 40px #ff0048;transform:scale(1.05);}
    #status {margin:20px;padding:15px;background:rgba(255,0,72,0.2);border-radius:10px;display:inline-block;}
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="container">
    <h1>üî• 24H TEMPORARY KEY</h1>
    <p>Complete the LootLabs tasks to receive your key</p>
    
    <div id="status">üîÑ Initializing security token...</div>
    
    <div class="instructions">
      <h3>üéØ STEP-BY-STEP:</h3>
      <ol>
        <li>Click the button below to go to LootLabs</li>
        <li>Complete ALL required tasks</li>
        <li>You'll be redirected back automatically</li>
        <li>Your key will be generated instantly!</li>
      </ol>
    </div>

    <button id="mainBtn" onclick="goToLootLabs()" disabled>
      ‚è≥ Preparing...
    </button>
    
    <p style="margin-top:30px;color:#ff6699;">
      üîí Protected: Direct access to key page is blocked
    </p>
  </div>

  <script>
    let accessToken = '';
    let tokenExpires = 0;

    // Gerar token de acesso
    async function generateToken() {
      try {
        const response = await fetch('/api/token');
        const data = await response.json();
        
        if (data.success) {
          accessToken = data.token;
          tokenExpires = data.expires;
          
          // Salvar no localStorage
          localStorage.setItem('keyAccessToken', accessToken);
          localStorage.setItem('tokenExpires', tokenExpires.toString());
          
          document.getElementById('status').innerHTML = '‚úÖ Security token ready';
          document.getElementById('mainBtn').disabled = false;
          document.getElementById('mainBtn').innerHTML = 'üöÄ GO TO LOOTLABS & GET KEY';
          
          console.log('üîê Token generated:', accessToken);
        }
      } catch (error) {
        document.getElementById('status').innerHTML = '‚ùå Error generating token';
      }
    }

    // Redirecionar para LootLabs
    function goToLootLabs() {
      if (!accessToken) {
        accessToken = localStorage.getItem('keyAccessToken');
      }
      
      if (accessToken) {
        // ‚úÖ SEU LINK DO LOOTLABS AQUI
        const lootLabsUrl = `https://lootdest.org/s?SyRPDnvX`;
        
        // Salvar token para verifica√ß√£o depois
        localStorage.setItem('pendingVerification', accessToken);
        
        console.log('üîó Going to LootLabs with token:', accessToken);
        window.open(lootLabsUrl, '_blank');
        
      } else {
        alert('Please wait for security token...');
      }
    }

    // Verificar token existente
    function checkExistingToken() {
      const savedToken = localStorage.getItem('keyAccessToken');
      const savedExpires = localStorage.getItem('tokenExpires');
      
      if (savedToken && savedExpires) {
        const now = Date.now();
        if (now < parseInt(savedExpires)) {
          accessToken = savedToken;
          tokenExpires = parseInt(savedExpires);
          document.getElementById('status').innerHTML = '‚úÖ Security token active';
          document.getElementById('mainBtn').disabled = false;
          document.getElementById('mainBtn').innerHTML = 'üöÄ GO TO LOOTLABS & GET KEY';
          return;
        } else {
          // Token expirado
          localStorage.removeItem('keyAccessToken');
          localStorage.removeItem('tokenExpires');
        }
      }
      
      generateToken();
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', checkExistingToken);

    particlesJS("particles-js", {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: "#ff0048" },
        shape: { type: "circle" },
        opacity: { value: 0.7, random: true },
        size: { value: 4, random: true },
        line_linked: { 
          enable: true, 
          distance: 150, 
          color: "#ff0048", 
          opacity: 0.4,
          width: 2
        },
        move: { 
          enable: true, 
          speed: 6,
          direction: "none",
          random: true,
          out_mode: "out"
        }
      }
    });
  </script>
</body>
</html>