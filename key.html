<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YOUR KEY ‚Ä¢ 24H</title>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    body {margin:0;background:#000;color:#ff0048;font-family:'Courier New',monospace;overflow:hidden;}
    #particles-js {position:absolute;width:100%;height:100%;background:#000;}
    .box {position:relative;z-index:2;text-align:center;padding-top:15vh;}
    h1 {font-size:55px;text-shadow:0 0 30px #ff0048;}
    #key {font-size:45px;letter-spacing:10px;background:#111;padding:30px;margin:50px auto;width:700px;border:3px solid #ff0048;box-shadow:0 0 40px #ff0048;border-radius:15px;}
    button {padding:18px 60px;font-size:26px;background:transparent;border:3px solid #ff0048;color:#ff0048;border-radius:15px;cursor:pointer;}
    button:hover {background:#ff0048;color:#000;box-shadow:0 0 60px #ff0048;}
    .error {color:#ff3333;font-size:24px;margin:30px;}
    .back-btn {position:absolute;top:20px;left:20px;padding:10px 20px;background:transparent;border:2px solid #ff0048;color:#ff0048;border-radius:8px;cursor:pointer;text-decoration:none;}
    .back-btn:hover {background:#ff0048;color:#000;}
  </style>
</head>
<body>
  <div id="particles-js"></div>
  
  <a href="/" class="back-btn">‚Üê Back to Home</a>
  
  <div class="box">
    <h1>KEY GENERATED</h1>
    <div id="key">üîí Verifying access...</div>
    <button onclick="copyKey()">COPY KEY</button>
    <p style="margin-top:40px;">Valid for 24 hours only</p>
    <div id="errorMessage" class="error"></div>
  </div>

  <script>
    particlesJS("particles-js", {"particles":{"number":{"value":100},"color":{"value":"#ff0048"},"line_linked":{"enable":true,"color":"#ff0048"}}});

    let key = "";

    async function generateKey() {
      try {
        // Buscar token do localStorage
        const accessToken = localStorage.getItem('keyAccessToken') || localStorage.getItem('pendingVerification');
        
        if (!accessToken) {
          showError('‚ùå ACCESS DENIED: Please complete LootLabs tasks first.');
          return;
        }

        document.getElementById('key').innerText = 'üîÑ Verifying access...';
        
        const response = await fetch(`/api/generate?token=${accessToken}`);
        
        if (response.ok) {
          key = await response.text();
          document.getElementById('key').innerText = key;
          
          // Limpar tokens ap√≥s uso
          localStorage.removeItem('keyAccessToken');
          localStorage.removeItem('pendingVerification');
          localStorage.removeItem('tokenExpires');
          
        } else {
          const errorText = await response.text();
          showError(`‚ùå ${errorText}`);
        }
      } catch (error) {
        showError('‚ùå Network error. Please try again from the homepage.');
      }
    }

    function showError(message) {
      document.getElementById('key').style.display = 'none';
      document.getElementById('errorMessage').innerText = message;
    }

    function copyKey() {
      if (key) {
        navigator.clipboard.writeText(key).then(() => {
          alert('‚úÖ Key copied to clipboard!');
        });
      }
    }

    // Gerar key quando a p√°gina carrega
    generateKey();
  </script>
</body>
</html>